#!/bin/bash

BASE=${COS_BASE_PATH}/api/connector_mgmt/v1/kafka_connector_clusters
NAME="${2:-addon-cos-fleetshard-operator-parameters}"

tmp_dir=$(mktemp -d -t ci-XXXXXXXXXX)

curl --insecure --oauth2-bearer "$(ocm token)" -S -s "${BASE}"/"${1}"/addon_parameters \
    | jq -r 'map("\(.id)=\(.value|tostring)")|.[]' \
    > "${tmp_dir}"/application.properties

kubectl create secret generic "${NAME}" \
    --from-file="${tmp_dir}"/application.properties \
    --dry-run="client" -o yaml \
    | kubectl apply -f -
